with open("accession.txt") as f:
    ACCESSNB = [line.strip() for line in f]

rule all:
    input: expand("data/public/{accession}/genomic.gff", accession=ACCESSNB)

rule ncbi_search:
    output:
        "download_links.txt"
    shell:
        """
        esearch -db assembly -query GCF_013265735.2 |\
        efetch -format docsum |\
        xtract -pattern DocumentSummary -if FtpPath_RefSeq -element FtpPath_RefSeq -else -element FtpPath_GenBank > {output} 
        """

def all_links():
    EXTENSIONS = ['_protein.faa.gz', '_genomic.gff.gz'] #  '_genomic.fna.gz',
    with open("download_links.txt") as f:
        LINK = ["https:"+line.strip().split(":")[1] + "/" + line.strip().split("/")[-1]+ extension for line in f for extension in EXTENSIONS]
    return LINK

rule url_creation:
    input:
        "download_links.txt"
    output:
        protein="data/public/{accession}/protein.faa",
        # genome="data/public/{accession}/genomic.fna",
        annot="data/public/{accession}/genomic.gff"
    params:
        link=all_links(),
    shell:
        """
        wget {params.link} \
        && mv {wildcards.accession}_* data/public/{wildcards.accession}/ \
        && gunzip data/public/{wildcards.accession}/*.gz\
        && ln -s data/public/{wildcards.accession}/*.faa data/public/{wildcards.accession}/protein.faa\
        && ln -s data/public/{wildcards.accession}/*.gff data/public/{wildcards.accession}/genomic.gff
        """
#         && ln -s data/public/{wildcards.accession}/*.fna data/public/{wildcards.accession}/genomic.fna\
